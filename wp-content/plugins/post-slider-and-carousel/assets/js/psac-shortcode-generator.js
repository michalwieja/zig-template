var timer,timeOut_Val=300,timeOut=timeOut_Val,tmpl_id=jQuery(".psac-customizer").attr("data-template"),preview_shortcode=jQuery(".psac-customizer").attr("data-shortcode"),checked_show_dep=[],dep_wrap=".psac-shrt-fields-panel",dependency=jQuery(dep_wrap+" .psac-cust-dependency").attr("data-dependency");function psac_check_valid_shortcode(){var e=jQuery.trim(jQuery(".psac-shrt-box").val()),p=e.substr(0,1),s=e.substr(-1);return""!=e&&("["==p&&"]"==s&&(p=(e=jQuery.trim(e.slice(1,-1))).substr(0,1),s=e.substr(-1)),"["!=p&&(e="["+e),"]"!=s&&(e+="]"),jQuery(".psac-shrt-box").val(e),temp_shrt_val=jQuery.trim(e.slice(1,-1)),wp.shortcode.attrs(temp_shrt_val))}function psac_generate_shortcode_preview(){var r="",e=jQuery(".psac-customizer"),p=jQuery(".psac-shrt-fields-panel"),s=preview_shortcode;clearTimeout(timer),timer=setTimeout(function(){e.find(".psac-shrt-loader").fadeIn(),r+="["+s,p.find('input[type="text"], input[type="checkbox"]:checked, input[type="radio"], input[type="number"], textarea, select').each(function(e,p){if(!jQuery(this).hasClass("psac-cust-hidden-field")){var s=jQuery(this).val(),t=jQuery(this).attr("name"),c=jQuery(this).attr("data-default"),a=jQuery(this).attr("data-empty");void 0===s||""==s&&!a||s==c||(r+=" "+t+'="'+s+'"')}}),r+="]",e.find(".psac-shrt-box").val(r),jQuery("#psac-customizer-shrt-form").submit(),e.find(".psac-shrt-preview-frame").load(function(){e.find(".psac-shrt-loader").fadeOut()})},timeOut)}function psac_check_ref_dependency(s){if(ref_dep=s in dependency,ref_dep){var t=jQuery(dep_wrap+" .psac-"+s).val();jQuery.each(dependency[s].show,function(e,p){jQuery(dep_wrap+" .psac-"+e).closest(".psac-customizer-row").hide(),jQuery(dep_wrap+" .psac-"+e).addClass("psac-cust-hidden-field"),-1===jQuery.inArray(t,p)||jQuery(dep_wrap+" .psac-"+s).hasClass("psac-cust-hidden-field")||(jQuery(dep_wrap+" .psac-"+e).closest(".psac-customizer-row").show(),jQuery(dep_wrap+" .psac-"+e).removeClass("psac-cust-hidden-field")),psac_check_ref_dependency(e)}),checked_show_dep.push(s)}}function psac_check_hide_ref_dependency(s){if(ref_dep=s in dependency,ref_dep){var t=jQuery(dep_wrap+" .psac-"+s).val();jQuery.each(dependency[s].hide,function(e,p){jQuery(dep_wrap+" .psac-"+e).closest(".psac-customizer-row").hide(),jQuery(dep_wrap+" .psac-"+e).addClass("psac-cust-hidden-field"),-1!=jQuery.inArray(t,p)||jQuery(dep_wrap+" .psac-"+s).hasClass("psac-cust-hidden-field")||(jQuery(dep_wrap+" .psac-"+e).closest(".psac-customizer-row").show(),jQuery(dep_wrap+" .psac-"+e).removeClass("psac-cust-hidden-field")),psac_check_hide_ref_dependency(e)})}}dependency=jQuery.parseJSON(dependency),jQuery(document).ready(function(c){c(document).on("click",".psac-shrt-dwp",function(){c("body").toggleClass("psac-shrt-full-preview"),c(this).toggleClass("psac-shrt-dwp-active")}),c("#psac-shrt-accordion").accordion({collapsible:!0,heightStyle:"content",icons:{header:"dashicons dashicons-arrow-down-alt2",activeHeader:"dashicons dashicons-arrow-up-alt2"}}),0<c(".psac-cust-color-box").length&&c(".psac-cust-color-box").wpColorPicker({change:function(e,p){psac_generate_shortcode_preview()},clear:function(){psac_generate_shortcode_preview()}}),c(document).on("change",'.psac-shrt-fields-panel select, .psac-shrt-fields-panel input[type="number"]',function(){field_timeout=c(this).attr("data-timeout"),timeOut="undefined"!=typeof field_timeout?field_timeout:timeOut_Val,psac_generate_shortcode_preview()}),c(document).on("keyup",'.psac-shrt-fields-panel input[type="text"], .psac-shrt-fields-panel input[type="number"]',function(){field_timeout=c(this).attr("data-timeout"),timeOut="undefined"!=typeof field_timeout?field_timeout:timeOut_Val,psac_generate_shortcode_preview()}),c(document).on("change",".psac-shrt-switcher",function(){redirect=c(this).find(":selected").attr("data-url"),"undefined"!=typeof redirect&&""!=redirect&&(window.location=redirect)}),jQuery("#psac-customizer-shrt-form").submit(function(e){var p=c(this).attr("target");if(void 0===p||""==p)return!1}),c(document).on("click",".psac-cust-shrt-generate",function(){var e=psac_check_valid_shortcode();if(e&&e.numeric[0]&&e.numeric[0]!==preview_shortcode)return alert(Psac_Shrt_Generator.shortcode_err),!1;e.named&&c.each(e.named,function(e,p){e&&c(".psac-shrt-fields-panel .psac-"+e).val(p).trigger("change").trigger("keyup")})}),""!=tmpl_id&&c(".psac-cust-shrt-generate").trigger("click"),dependency?c.each(dependency,function(e,p){e&&(setTimeout(function(){-1==c.inArray(e,checked_show_dep)&&c(dep_wrap+" .psac-"+e).trigger("change")},10),c(document).on("change keyup",dep_wrap+" .psac-"+e,function(){var s=c(this).val();p.show&&c.each(p.show,function(e,p){c(dep_wrap+" .psac-"+e).closest(".psac-customizer-row").hide(),c(dep_wrap+" .psac-"+e).addClass("psac-cust-hidden-field"),-1!==c.inArray(s,p)&&(c(dep_wrap+" .psac-"+e).closest(".psac-customizer-row").show(),c(dep_wrap+" .psac-"+e).removeClass("psac-cust-hidden-field")),psac_check_ref_dependency(e)}),p.hide&&c.each(p.hide,function(e,p){c(dep_wrap+" .psac-"+e).closest(".psac-customizer-row").show(),c(dep_wrap+" .psac-"+e).removeClass("psac-cust-hidden-field"),-1!==c.inArray(s,p)&&(c(dep_wrap+" .psac-"+e).closest(".psac-customizer-row").hide(),c(dep_wrap+" .psac-"+e).addClass("psac-cust-hidden-field")),psac_check_hide_ref_dependency(e)})}))}):psac_generate_shortcode_preview(),c(document).on("click",".psac-shrt-tmpl-save",function(){var p=c(this),s=p.closest(".psac-popup-wrp"),e=c(".psac-shrt-box").val();s.find(".psac-popup-notice").hide().removeClass("psac-popup-notice-err"),s.find(".psac-popup-spinner").css("visibility","visible"),p.attr("disabled","disabled");var t={action:"psac_save_shortcode_tmpl",form_data:p.closest("form").serialize(),shortcode:e,type:preview_shortcode,tmpl_id:tmpl_id};c.post(ajaxurl,t,function(e){0==e.success?s.find(".psac-popup-notice").addClass("psac-popup-notice-err"):""!=e.redirect_url&&(window.location.href=e.redirect_url),s.find(".psac-popup-notice").html(e.msg).show(),s.find(".psac-popup-spinner").css("visibility","hidden"),p.removeAttr("disabled","disabled")})})});